<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="Peed">

	<select id="getpeedlist" parameterType="java.lang.Integer" resultType="sist.co.model.PeedDTO">
		SELECT SEQ, MEMBER_SEQ, IMAGE, PEED_LIKE, REGI_DATE, CONTENT
		FROM(
			SELECT ROWNUM AS RN, SEQ, MEMBER_SEQ, IMAGE, PEED_LIKE, REGI_DATE, CONTENT
			FROM(
				SELECT ROW_NUMBER() OVER (PARTITION BY PEED.SEQ ORDER BY PEED.REGI_DATE ASC) as rnum, PEED.SEQ,PEED.MEMBER_SEQ,PEED.IMAGE,PEED.PEED_LIKE,PEED.REGI_DATE,PEED.CONTENT
				FROM INSTA_FOLLOW FOLLOW, INSTA_PEED PEED
				WHERE FOLLOW.FOLLOW = PEED.MEMBER_SEQ
				AND FOLLOW.MEMBER_SEQ = #{seq} OR PEED.MEMBER_SEQ = #{member_seq}
			) A
			WHERE rnum = 1
		)
		WHERE RN BETWEEN #{start} AND #{end} 
	</select>
	
	<insert id="writePeed" parameterType="sist.co.model.PeedDTO">
		INSERT INTO INSTA_PEED(SEQ, MEMBER_SEQ, IMAGE, PEED_LIKE, REGI_DATE, CONTENT)
  		VALUES(SEQ_INSTA_PEED.NEXTVAL, #{member_seq}, #{image}, 0, SYSDATE, #{content})
	</insert>
	
	<select id="getPeed" parameterType="sist.co.model.MemberDTO" resultType="sist.co.model.PeedDTO">
		SELECT * FROM INSTA_PEED
			WHERE MEMBER_SEQ=#{seq}
	</select>
	
</mapper>